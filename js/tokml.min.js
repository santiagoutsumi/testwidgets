!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.tokml=e()}}(function(){return function e(t,r,n){function o(l,a){if(!r[l]){if(!t[l]){var c="function"==typeof require&&require;if(!a&&c)return c(l,!0);if(i)return i(l,!0);var u=new Error("Cannot find module '"+l+"'");throw u.code="MODULE_NOT_FOUND",u}var s=r[l]={exports:{}};t[l][0].call(s.exports,function(e){var r=t[l][1][e];return o(r?r:e)},s,s.exports,e,t,r,n)}return r[l].exports}for(var i="function"==typeof require&&require,l=0;l<n.length;l++)o(n[l]);return o}({1:[function(e,t,r){function n(e,t){return function(r){if(!r.properties||!q.valid(r.geometry))return"";var n=q.any(r.geometry);if(!n)return"";var o="",i="";if(e.simplestyle){var l=L(r.properties);l&&(q.isPoint(r.geometry)&&d(r.properties)?(-1===t.indexOf(l)&&(o=y(r.properties,l),t.push(l)),i=O("styleUrl","#"+l)):(q.isPolygon(r.geometry)||q.isLine(r.geometry))&&x(r.properties)&&(-1===t.indexOf(l)&&(o=b(r.properties,l),t.push(l)),i=O("styleUrl","#"+l)))}return o+O("Placemark",c(r.properties,e)+u(r.properties,e)+p(r.properties,e)+s(r.properties,e)+n+i)}}function o(e,t){if(!e.type)return"";var r=[];switch(e.type){case"FeatureCollection":return e.features?e.features.map(n(t,r)).join(""):"";case"Feature":return n(t,r)(e);default:return n(t,r)({type:"Feature",geometry:e,properties:{}})}}function l(e){return void 0!==e.documentName?O("name",e.documentName):""}function a(e){return void 0!==e.documentDescription?O("description",e.documentDescription):""}function c(e,t){return e[t.name]?O("name",G(e[t.name])):""}function u(e,t){return e[t.description]?O("description",G(e[t.description])):""}function s(e,t){return e[t.timestamp]?O("TimeStamp",O("when",G(e[t.timestamp]))):""}function f(e){return e.map(function(e){return e.join(",")}).join(" ")}function p(e,t){return t.extendedData?O("ExtendedData",D(e).map(m).join("")):""}function m(e){return O("Data",O("value",G(e[1])),[["name",G(e[0])]])}function d(e){return!!(e["marker-size"]||e["marker-symbol"]||e["marker-color"]||e.scale||e.href||e["label-color"]||e["label-scale"])}function y(e,t){return O("Style",O("IconStyle",O("Icon",O("href",g(e)))+v(e)+h(e)+k(e))+w(e),[["id",t]])}function g(e){var t=e["marker-size"]||"medium",r=e["marker-symbol"]?"-"+e["marker-symbol"]:"",n=(e["marker-color"]||"7e7e7e").replace("#",""),o=e.href;return o||"https://api.tiles.mapbox.com/v3/marker/pin-"+t.charAt(0)+r+"+"+n+".png"}function v(e){return e.color?O("color",M(e.color,e["marker-opacity"]||1)):""}function h(e){return void 0!==e.scale?O("scale",e.scale):""}function k(e){return O("hotSpot","",[["xunits",e.xunits||"fraction"],["yunits",e.yunits||"fraction"],["x",void 0!==e.x?e.x:.5],["y",void 0!==e.y?e.yx:.5]])}function x(e){for(var t in e)if({stroke:!0,"stroke-opacity":!0,"stroke-width":!0,fill:!0,"fill-opacity":!0,"label-color":!0,"label-scale":!0}[t])return!0}function b(e,t){var r=O("LineStyle",[O("color",M(e.stroke,e["stroke-opacity"])||"ff555555")+O("width",void 0===e["stroke-width"]?2:e["stroke-width"])]),n="";return(e.fill||e["fill-opacity"])&&(n=O("PolyStyle",[O("color",M(e.fill,e["fill-opacity"])||"88555555")])),O("Style",r+n+w(e),[["id",t]])}function w(e){return e["label-color"]||void 0!==e["label-scale"]?O("LabelStyle",S(e)+P(e)):""}function S(e){return e["label-color"]?O("color",M(e["label-color"],void 0!==e["label-opacity"]?e["label-opacity"]:1)):""}function P(e){return void 0!==e["label-scale"]?O("scale",e["label-scale"]):""}function L(e){var t="";return e["marker-symbol"]&&(t=t+"ms"+e["marker-symbol"]),e["marker-color"]&&(t=t+"mc"+e["marker-color"].replace("#","")),e["marker-size"]&&(t=t+"ms"+e["marker-size"]),e.href&&(t=t+"mh"+j(e.href)),e.color&&(t=t+"mco"+e.color),e.scale&&(t=t+"msc"+e.scale),e["label-color"]&&(t=t+"lco"+e["label-color"]),e["label-scale"]&&(t=t+"lsc"+e["label-scale"]),e.stroke&&(t=t+"s"+e.stroke.replace("#","")),e["stroke-width"]&&(t=t+"sw"+e["stroke-width"].toString().replace(".","")),e["stroke-opacity"]&&(t=t+"mo"+e["stroke-opacity"].toString().replace(".","")),e.fill&&(t=t+"f"+e.fill.replace("#","")),e["fill-opacity"]&&(t=t+"fo"+e["fill-opacity"].toString().replace(".","")),t}function j(e){var t=0;if(0==e.length)return t;for(i=0;i<e.length;i++)char=e.charCodeAt(i),t=(t<<5)-t+char,t&=t;return t}function M(e,t){if("string"!=typeof e)return"";if(e=e.replace("#","").toLowerCase(),3===e.length)e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2];else if(6!==e.length)return"";var r=e[0]+e[1],n=e[2]+e[3],o=e[4]+e[5],i="ff";return"number"==typeof t&&t>=0&&1>=t&&(i=(255*t).toString(16),i.indexOf(".")>-1&&(i=i.substr(0,i.indexOf("."))),i.length<2&&(i="0"+i)),i+o+n+r}function D(e){var t=[];for(var r in e)t.push([r,e[r]]);return t}var C=e("strxml"),O=C.tag,G=C.encode;t.exports=function(e,t){return t=t||{documentName:void 0,documentDescription:void 0,name:"name",description:"description",simplestyle:!1,timestamp:"timestamp",extendedData:!0},'<?xml version="1.0" encoding="UTF-8"?>'+O("kml",O("Document",l(t)+a(t)+o(e,t)),[["xmlns","http://www.opengis.net/kml/2.2"]])};var q={Point:function(e){return O("Point",O("coordinates",e.coordinates.join(",")))},LineString:function(e){return O("LineString",O("coordinates",f(e.coordinates)))},Polygon:function(e){if(!e.coordinates.length)return"";var t=e.coordinates[0],r=e.coordinates.slice(1),n=O("outerBoundaryIs",O("LinearRing",O("coordinates",f(t)))),o=r.map(function(e){return O("innerBoundaryIs",O("LinearRing",O("coordinates",f(e))))}).join("");return O("Polygon",n+o)},MultiPoint:function(e){return e.coordinates.length?O("MultiGeometry",e.coordinates.map(function(e){return q.Point({coordinates:e})}).join("")):""},MultiPolygon:function(e){return e.coordinates.length?O("MultiGeometry",e.coordinates.map(function(e){return q.Polygon({coordinates:e})}).join("")):""},MultiLineString:function(e){return e.coordinates.length?O("MultiGeometry",e.coordinates.map(function(e){return q.LineString({coordinates:e})}).join("")):""},GeometryCollection:function(e){return O("MultiGeometry",e.geometries.map(q.any).join(""))},valid:function(e){return e&&e.type&&(e.coordinates||"GeometryCollection"===e.type&&e.geometries&&e.geometries.every(q.valid))},any:function(e){return q[e.type]?q[e.type](e):""},isPoint:function(e){return"Point"===e.type||"MultiPoint"===e.type},isPolygon:function(e){return"Polygon"===e.type||"MultiPolygon"===e.type},isLine:function(e){return"LineString"===e.type||"MultiLineString"===e.type}}},{strxml:2}],2:[function(e,t,r){function n(e){return e&&e.length?" "+e.map(function(e){return e[0]+'="'+e[1]+'"'}).join(" "):""}function o(e,t){return"<"+e+n(t)+"/>"}function i(e,t,r){return"<"+e+n(r)+">"+t+"</"+e+">"}function l(e){return(null===e?"":e.toString()).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}t.exports.attr=n,t.exports.tagClose=o,t.exports.tag=i,t.exports.encode=l},{}]},{},[1])(1)});